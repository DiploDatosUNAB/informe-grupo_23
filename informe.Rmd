---
title: "TP2"
author: "Mauro Cejas Marcovecchio"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)

```

## Introducción

Los datos utilizados en este Trabajo Práctico corresponden al 'Presupuesto de gastos y su ejecución' del portal de Datos Abiertos del Ministerio de Economía de la República Argentina. Como su nombre lo indica, contiene información acerca de los montos presupuestados iniciales, vigentes, montos comprometidos, ejecutados y pagados de cada uno de los sectores de la Administración Pública Central, agrupados de forma diaria. Cabe aclarar que únicamente incluye datos del ejercicio 2023, que se encuentran expresados en millones de pesos y fue actualizado por última vez el 09 de junio del mismo año.

Por lo pronto, con el objetivo de contar con la versión más actualizada disponible de esta base de datos cada vez que lo querramos así, vamos a armar un script aparte para automatizar la descarga desde la web. Éste será llamado actualizacion_datos.R y podrá ser encontrado en su carpeta correspondiente.

## Exploración de los datos

En primer lugar, vamos a analizar los datos con los que contamos. Para ello, vamos a especificar el separador de decimales que es utilizado en el archivo. 

```{r}

presupuesto <- read_csv("datos/credito-diario-2023.csv", locale = locale(decimal_mark = ","))

```

Primero, vamos a renombrar algunas columnas para que sea más fácil comprender qué datos contienen.

```{r}

presupuesto <- presupuesto |>
  rename (presupuesto_inicial = credito_presupuestado, presupuesto_vigente = credito_vigente, comprometido = credito_comprometido, ejecutado = credito_devengado, pagado = credito_pagado, dia = impacto_presupuestario_fecha, mes = impacto_presupuestario_mes, anio = impacto_presupuestario_anio )

```

Luego, vamos a descartar aquellas columnas cuyo análisis no nos interesa.

```{r}

presupuesto <- presupuesto |>
  select(-c(ultima_actualizacion_fecha, codigo_bapin_desc, codigo_bapin_id, prestamo_externo_desc, prestamo_externo_id, ejercicio_presupuestario))

```


Así, podemos calcular la suma del presupuesto total vigente de toda la administración nacional.

```{r}

presupuesto |>
  summarise(presup_vigente_total = sum(presupuesto_vigente, na.rm = TRUE))


```

Como también podemos discriminar qué presupuesto fue asignado a cada jurisdicción.

```{r}

presupuesto |>
  group_by(jurisdiccion_desc) |>
  summarise(presup_vigente_minist = sum(presupuesto_vigente, na.rm = TRUE)) |>
  arrange(desc(presup_vigente_minist))


```

También podemos calcular la media de presupuesto asignada por jurisdicción y su devío estándar.

```{r}

presupuesto |>
  group_by(jurisdiccion_desc) |>
  summarise(presup_vigente_minist = sum(presupuesto_vigente, na.rm = TRUE)) |>
  summarise(presup_vigente_prom = mean(presup_vigente_minist, na.rm = TRUE))


```

```{r}

presupuesto |>
  group_by(jurisdiccion_desc) |>
  summarise(presup_vigente_minist = sum(presupuesto_vigente, na.rm = TRUE)) |>
  summarise(presup_vigente_sd = sd(presup_vigente_minist, na.rm = TRUE))


```

Podemos descubrir las tres jurisdicciones que tienen mayor cantidad de presupuesto asignado.

```{r}

presupuesto |>
  group_by(jurisdiccion_desc) |>
  summarise(presup_vigente_minist = sum(presupuesto_vigente, na.rm = TRUE)) |>
  slice_max(presup_vigente_minist, n = 3)
  

```

Y aquellas que tienen menor presupuesto asignado

```{r}

presupuesto |>
  group_by(jurisdiccion_id) |>
  summarise(presup_vigente_minist = sum(presupuesto_vigente, na.rm = TRUE)) |>
  slice_min(presup_vigente_minist, n = 3)
  

```

## Hipótesis

A partir de los datos del Presupuesto de gastos y su ejecución podríamos plantearnos una cantidad ilimitada de preguntas. Algunas de ellas pueden ser cómo fue la evolución de la ejecución del presupuesto a lo largo del año en su conjunto y en cada uno de los ministerios. Otra puede estar relacionada a cómo se vió modificado el presupuesto a lo largo del año, tomando en cuenta los cambios económicos que tuvo nuestro país. En lo que sigue del Trabajo Práctico, intentaremos responderlas.

## Desarrollo

En primer lugar, entonces podemos graficar la evolución de la ejecución del presupuesto a lo largo de 2023. Para ello, podemos utilizar ggplot2 y expresarlo de billones de pesos (para poder verlo de forma más clara).

```{r}

presupuesto |>
  group_by(mes) |>
  summarise(ejecutado_mes = sum(ejecutado, na.rm = TRUE)) |>
  ggplot(aes(mes, ejecutado_mes/1000000)) +
    geom_col(fill = "blue")

```

Para contar con los valores de la ejecución mensual que se ha realizado, podemos hacer una tabla:

```{r}

presupuesto |>
  group_by(mes) |>
  summarise(ejecutado_mes = sum(ejecutado, na.rm = TRUE))


```

De esta manera, podemos ver que el mes de mayor ejecución nominal, en lo que va del año, es el mes de Mayo.

Por otro lado, vamos a graficar la ejecución de cada una de las jurisdicciones (sin agregarla al Knit), para poder contar con estos gráficos por si queremos hacer un análisis pormenorizado.

```{r}

J <- unique(presupuesto$jurisdiccion_id)
  
for (ministerio in J) {
  
  presupuesto |>
    
    filter(jurisdiccion_id == ministerio) |>
  
      ggplot(aes(mes, ejecutado), fill = "colores") +
      geom_col(aes(colour = as.factor(programa_desc))) +
      labs(title = paste0("Ejecucion de la jurisdiccion ", ministerio )) +
      theme(legend.position = "none")
      
      ggsave(path = "imagenes", paste0("ejecucion ", ministerio , ".png"))
  
}


```

En último lugar, podemos analizar las modificaciones en el presupuesto vigente en billones de pesos que hubo a lo largo del ejercicio.

```{r}

presupuesto |>
  group_by(mes)|>
  summarise(vigente_mes = sum(presupuesto_vigente, na.rm = TRUE)) |>
  ggplot(aes(mes, vigente_mes/1000000)) +
    geom_col(fill = "red")

```

También, podemos comparar también el porcentaje de lo que representa hoy el Presupuesto Vigente del Presupuesto Inicial:

```{r}

presupuesto |>
  summarise(presup_vig_sobre_inic = sum(presupuesto_vigente, na.rm = TRUE) / sum(presupuesto_inicial, na.rm = TRUE)) *100


```

De esta manera, comprobamos que la variación es únicamente del 0.6%, bastante alejadas del aumento que sería necesario para igualar al poder de compra de un presupuesto cuya ley estimaba una inflación anual del 60%.
